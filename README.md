# Accept Portal Dialog

Automatically accept Portal dialogs for Input Capture and Remote Control/Desktop.

## Who's this for?

This tool was born out of frustration with the Portal permission dialogs:

<img width="782" height="622" alt="GNOME Remote Desktop" src="https://github.com/user-attachments/assets/7f1eeb02-e816-46dd-b1db-47139523cb90" />

Users and developers of applications like Deskflow, Synergy, and LAN Mouse find Portal permission dialogs frustrating. For users, they must be present at the remote computer to accept the dialog.

For a Deskflow/Synergy developer, or any remote access tool developer, these dialogs are a nightmare during development as you will likely see them hundreds of times a day.

This tool is for people who find these dialogs annoying, and want them to be automatically accepted.

> [!WARNING]
> This tool will decrease the security of your computer,
> so please use it only if you know what you're doing.

## Long term goal

This tool is a workaround, not a long-term fix.

The Portal project is working on fixing this UX problem, but it will take time to become generally available.

Once the fix is complete in Portal and it becomes ubiquitous, this project will become obsolete and can be archived.

## What people say

The Linux community is divided on this tool, and opinions about it are mixed.

One [Reddit user](https://www.reddit.com/r/linux/comments/1mlxgiv/comment/n7tl9db/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button) says:
> Security implications aside, this is a bad idea in itself.

But, on the other hand:
> I believe this program wouldn't exist if the actual end-user implementations were well done enough.
> -- [Reddit user](https://www.reddit.com/r/linux/comments/1mlxgiv/comment/n7uejfz/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button)

## Tool setup

On both GNOME and KDE, you'll need to install: [`ydotool`](https://gabrielstaples.com/ydotool-tutorial/)

### GNOME

GNOME requires you to enable unsafe mode:

1. Press Alt+F2
2. Enter: `lg`
3. Run: `global.context.unsafe_mode = true`

### KDE

On KDE, you'll also need to install: [`kdotool`](https://github.com/jinliu/kdotool)

## Running

To start monitoring for Portal permission dialogs and automatically accepting them,
run the Python script from a Terminal:

```
./accept-portal-dialog.py
```

## Config

A config file is generated by default at `~/.config/accept-portal-dialog/config.ini`:

The values can be changed, and will be used when the tool is restarted.
You should already be familiar with editing .ini files before attempting this.

> [!WARNING]
> The minimum sleep/delay values 0.5; any lower and the GUI doesn't have time to do
> it's fancy animations. This is especially noticeable on GNOME.

Numbers in the sequence are `ydotool` compatible key codes:
| Key | Code |
| --- | ---- |
| Alt | 56 |
| S | 31 |
| Enter | 28 |
| Tab | 15 |

Example for Chinese users who want to accept the 'Input capture' dialog on KDE:

```
[kde]
dialog_titles = 請求遠端控制權限
```

Example to change the accept key sequence to Alt+S on KDE:

```
[kde]
accept_sequence_0 = 56,31
```

Default for `accept_sequence_0` on KDE is `Enter`. This is OK on KDE as the dialog is a bit
more consistently designed. The GNOME dialogs may have varying tab orders, so Alt+S tends to
work better in that case which is why it's the default. However, Alt+S is not great for i18n
so you may want to use a series of Tap presses and the Enter key.

```
[gnome]
accept_sequence_0 = 28
accept_sequence_1 = <sleep>
accept_sequence_3 = 15
accept_sequence_4 = 15
accept_sequence_5 = 28
```

You may need to remove a tab depending on the dialog title (e.g. remote desktop or input capture).

The `<sleep>` is necessary on GNOME, as it takes a moment for the GUI to do some fancy animation
after toggling the switch to enabled.

## Demo

```
$ accept-portal-dialog
[2025-08-09 00:29:02] Checking for yDoTool daemon...
[2025-08-09 00:29:02] Found yDoTool daemon, socket: /run/user/1000/.ydotool_socket
[2025-08-09 00:29:02] Watching for Portal permission dialogs... Press Ctrl+C to stop.
[2025-08-09 00:29:06] Found GNOME dialog: Remote Desktop (ID: 2176466517, Focus: yes)
[2025-08-09 00:29:06] Accepting GNOME Portal permission dialog
[2025-08-09 00:29:06] Pressing down keys: ['28:1'], up keys: ['28:0']
[2025-08-09 00:29:06] Pressing down keys: ['56:1', '31:1'], up keys: ['31:0', '56:0']
```

## Dialogs

These dialogs are supported by default.

<img width="782" height="622" alt="GNOME Remote Desktop" src="https://github.com/user-attachments/assets/7f1eeb02-e816-46dd-b1db-47139523cb90" />

<img width="622" height="422" alt="GNOME Capture Input" src="https://github.com/user-attachments/assets/2f777c12-9a55-4d5f-8f3b-4af4740fcb4d" />

<img width="612" height="439" alt="KDE Remote control requested" src="https://github.com/user-attachments/assets/b8cc1cfa-3f3c-4325-a291-2f73670660ce" />
<img width="654" height="333" alt="KDE Input Capture Requested" src="https://github.com/user-attachments/assets/18195a03-db2a-487c-8f1c-d74b2482aaf5" />
